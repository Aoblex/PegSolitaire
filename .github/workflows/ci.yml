name: CI Build

on:
  push:
    branches: [ main, master, develop ]
    paths-ignore:
      - '**.md'
      - 'prompts/**'
  pull_request:
    branches: [ main, master, develop ]
    paths-ignore:
      - '**.md'
      - 'prompts/**'

env:
  QT_VERSION: 6.5.3
  BUILD_TYPE: Release

jobs:
  build-test:
    runs-on: windows-2022
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install Qt
      uses: jurplel/install-qt-action@v3
      with:
        version: ${{ env.QT_VERSION }}
        host: windows
        target: desktop
        arch: win64_msvc2019_64
        cache: true
    - name: Setup CMake and Ninja
      uses: jwlawson/actions-setup-cmake@v2
      with:
        cmake-version: '3.28.x'

    - name: Setup Ninja
      uses: seanmiddleditch/gha-setup-ninja@master

    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      with:
        arch: x64

    - name: Configure CMake
      run: |
        cmake -B build -S . `
          -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }} `
          -DCMAKE_PREFIX_PATH="${{ env.Qt6_DIR }}" `
          -G "Ninja"

    - name: Build
      run: cmake --build build --parallel    - name: Test executable
      run: |
        if (Test-Path "build\PegSolitaire.exe") {
          Write-Host "✅ PegSolitaire.exe built successfully"
          $fileInfo = Get-Item "build\PegSolitaire.exe"
          Write-Host "File size: $($fileInfo.Length) bytes"
          Write-Host "Last modified: $($fileInfo.LastWriteTime)"
        } else {
          Write-Host "❌ PegSolitaire.exe not found"
          exit 1
        }
